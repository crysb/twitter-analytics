---
title: "Twitter Analytics - Arctic Data Centert"
date: "Last updated June 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Arctic Data Center Twitter Metrics

This report contains information about the Arctic Data Center's Twitter account, @ArcticDataCtr, and how effective it is at engaging a wider audience of Arctic researchers, students, and other data organizations.

### Data Collection - Summary

Data was collected manually on the first of the month from https://analytics.twitter.com/user/arcticdatactr/home. This summary file contains:

* month: month of Tweet information
* year: year of Tweet information
* tweets: number of Tweets that month
* profile-visits: number of times users visited the @ArcticDataCtr profile page
* new-followers: number of new followers gained (gross new followers; does not account for followers lost)
* tweet-impressions: number of times users are served @ArcticDataCtr tweets in timeline, search results, or from the profile
* mentions: number of times @ArcticDataCtr was mentioned in tweets
* number-followers: number of followers, manually copied from https://twitter.com/arcticdatactr. 
    * Number of followers is the only piece of data in this file that is only available from Twitter at the time you access the site i.e. it is not made available with the rest of the data in this dataset. Thus, there are NAs for dates prior to the time I started to collect this data or for dates before I realized this data was ephemeral.

### Data Collection - Monthly Tweets

Data was downloaded monthly from https://analytics.twitter.com/user/arcticdatactr/home. These monthly files contain:

* Tweet ID: the identifier for the Tweet, which can be used to find the permanent URL
* Tweet permalink: permanent URL for the Tweet
* Tweet text: the text (content) of the Tweet
* time: the time the Tweet was sent (GMT)
* impressions: number of times users are served the tweet in timeline, search results, or from the @ArcticDataCtr profile
* engagements: total number of times a user interacted with a Tweet. Clicks anywhere on the Tweet, including Retweets, replies, follows, likes, links, cards, hashtags, embedded media, username, profile photo, or Tweet expansion
* engagement rate: number of engagements divided by impressions
* retweets: number of times that Tweet was retweeted
* replies: number of replies that Tweet generated
* user profile clicks: number of times a user clicked on the @ArcticDataCtr profile from that particular tweet
* URL clicks: number of times that URL within the tweet was clicked
* hashtag clicks: number of times any of your hashtags were clicked from that tweet
* detail expands: number of times users clicked 'see more' on your tweet
* permalink clicks: clicks on the Tweet permalink
* follows: times a user followed you directly from the Tweet
* email tweet: number of times the Tweet is shared by email
* media views: number of times media attached to the Tweet is viewed
* media engagements: an interaction on a tweet that has a piece of media (photo, vine, other video, etc) in it

Other metrics that are collected are all about promoted views, etc. which the Arctic Data Center doesn't use, and as such those were excluded from the analysis.

```{r load-packages, echo=FALSE,results=FALSE,message=FALSE}
library(readr)
library(tidyr)
library(knitr)
library(ggplot2)
library(rtweet)
library(dplyr)
library(tidytext)
library(kableExtra)
library(ggraph)
library(formattable)
library(data.table)
library(dendroTools)
library(cowplot)
library(tm)
library(tokenizers)
library(tidyverse)
library(wordcloud)
library(SnowballC)
library(RColorBrewer)
library(wordcloud2)
library(widyr)
library(igraph)
library(topicmodels)
library(DataCombine)
library(ggThemeAssist)
library(quanteda)
library(data.table)
library(lubridate)
library(textclean)
```

```{r raw-data, echo=FALSE,results=FALSE,message=FALSE}
twitter_summary_metrics <- read_csv("~/Documents/Twitter Analytics/Raw Data/twitter-summary-metrics.csv")
twitter_summary_metrics$Date <-as.Date(twitter_summary_metrics$Date) 
```

```{r creating-custom-theme, echo=FALSE,results=FALSE,message=FALSE}
theme_ADC<- function() {
  theme_bw(base_size=12,base_family="Helvetica") %+replace%
    theme(
      plot.title=element_text(size=11, face="bold",margin=margin(10,0,10,0),color="#1D244F"),
      plot.subtitle = element_text(size=10,margin=margin(0,0,10,0),color="#1D244F"),
        axis.text.x = element_text(angle=50, size=8, vjust=0.5, color="#1D244F"),
        axis.text.y = element_text(size=8, color="#1D244F"),
        axis.title.x = element_text(color="#1D244F",vjust=-.5,size=10),
        axis.title.y = element_text(color="#1D244F",angle=90,vjust=.5,size=10),
        panel.background=element_rect(fill="white"),
        axis.line = element_line(color="#1D244F"),
      panel.grid.major = element_line(colour = "white", size = 0.2), 
    panel.grid.minor = element_line(colour = "white", size = 0.5),
    )
}

ADC_colors <- c(
  `navy`="#1D244E",
  `light blue`="#B3E1E7",
  `green`="#19B369",
  `light green`="#79FD81",
  `teal`="#146660",
  `dark teal`="#1B887E",
  `grey`="#767171",
  `black`="#000000")

ADC_cols <- function(...) {
  cols <- c(...)

  if (is.null(cols))
    return (ADC_colors)

  ADC_colors[cols]
}

ADC_palettes<-
  list(
    `main`=ADC_cols("navy","light blue","teal","light green"),
    `all`=ADC_cols("navy","light blue","teal","light green","green","dark teal","grey","black")
  )

ADC_pal <- function(palette = "all", reverse = FALSE, ...) {
  pal <- ADC_palettes[[palette]]

  if (reverse) pal <- rev(pal)

  colorRampPalette(pal, ...)
}

scale_color_ADC <- function(palette = "all", discrete = TRUE, reverse = FALSE, ...) {
  pal <- ADC_pal(palette = palette, reverse = reverse)

  if (discrete) {
    discrete_scale("colour", paste0("ADC_", palette), palette = pal, ...)
  } else {
    scale_color_gradientn(colours = pal(256), ...)
  }
}
```

## Summary Information

```{r monthly-tweets, echo=FALSE,results=FALSE,message=FALSE}
monthlytweets<-ggplot(data = twitter_summary_metrics, aes(x=Date, y=Tweets)) +
  geom_line(color="#156760",size=1.5)+
  labs(title='Monthly Tweets Over Time',
       x="Date",
       y="Tweets")

monthlytweets<-monthlytweets+theme_ADC()
```

```{r followers, echo=FALSE}
followers<-ggplot(data = twitter_summary_metrics, aes(x=Date, y=New_Followers)) +
  geom_line(color="#156760",size=1.5)+
  labs(title='Monthly Followers Over Time',
       x="Date",
       y="Followers")

followers<-followers+theme_ADC()

```

```{r impressions, echo=FALSE}
impressions<-ggplot(data = twitter_summary_metrics, aes(x=Date, y=Tweet_Impressions)) +
  geom_point(color="#156760",size=2.5)+
    labs(title='Monthly Impressions Over Time',
       x="Date",
       y="Impressions")

impressions<-impressions+theme_ADC()
```

```{r tweet-impressions, echo=FALSE}
tweetimpressions<-ggplot(data = twitter_summary_metrics, aes(x=Tweets, y=Tweet_Impressions)) +
  geom_point(color="#156760",size=2.5)+
  labs(title='Impact of Tweets on Impressions',
       x="Tweets",
       y="Impressions")+
  stat_smooth(method="lm", se=FALSE, color="#B4E6EA",size=1)

tweetimpressions<-tweetimpressions+theme_ADC()
```

```{r 4-graphs, echo=FALSE}
plot_grid(monthlytweets,followers,impressions,tweetimpressions,
          ncol=2, nrow=2,
          rel_widths = c(1.5,1.5,1.5,1.5))
```

```{r twitter-data, echo=FALSE}
ADC <- get_timeline("@ArcticDataCtr", n= 3200)
```

```{r twitter-clean, echo=FALSE}
ADC$text <-replace_html(ADC$text,symbol=TRUE)

#Creating an organic tweet list
#Remove retweets
ADC_tweets_organic <- ADC[ADC$is_retweet==FALSE, ] 
# Remove replies
ADC_tweets_organic <- subset(ADC_tweets_organic, is.na(ADC_tweets_organic$reply_to_status_id)) 
ADC_tweets_organic$created_at <-as.character.Date(ADC_tweets_organic$created_at) 
ADC_tweets_organic$hashtags <- lapply(ADC_tweets_organic$hashtags, paste0, collapse = ", ")

#Keeping ONLY the retweets
ADC_retweets <- ADC[ADC$is_retweet==TRUE, ] 

#Keeping ONLY the replies
ADC_replies <- subset(ADC, !is.na(ADC$reply_to_status_id))
```

#### Top 10: Most Liked Tweets
```{r twitter-faves, echo=FALSE}

ADC_tweets_organic <- ADC_tweets_organic %>% arrange(-favorite_count)
ADC_tweets_fav <- select(ADC_tweets_organic,text,created_at,favorite_count, retweet_count,hashtags)
ADC_tweets_fav <- ADC_tweets_fav[1:10,]

ADC_tweets_fav %>% 
  kable(col.names=c("Tweet","Date and Time","Likes","Retweets", "Hashtags Used")) %>% 
  kable_styling() %>% 
  column_spec(2,width="10em") %>% 
  column_spec(1,width="35em") %>% 
  column_spec(5,width="10em") 

```

#### Top 10: Most Retweeted Tweets
```{r twitter-retweets, echo=FALSE}

ADC_tweets_organic <- ADC_tweets_organic %>% arrange(-retweet_count)
ADC_tweets_retweets <- select(ADC_tweets_organic,text,created_at,favorite_count, retweet_count,hashtags)
ADC_tweets_retweets <- ADC_tweets_retweets[1:10,]

ADC_tweets_retweets %>% 
  kable(col.names=c("Tweet","Date and Time","Likes","Retweets", "Hashtags Used")) %>% 
  kable_styling() %>% 
  column_spec(2,width="10em") %>% 
  column_spec(1,width="35em") %>% 
  column_spec(5,width="10em") 

```

#### Distribution of replies, retweets, and organic tweets
```{r twitter-ratio, echo=FALSE}

tweet_ratio <- data.frame(
  category=c("Retweets", "Replies", "Organic Tweets"),
  count=c(nrow(ADC_retweets), nrow(ADC_replies), nrow(ADC_tweets_organic))
)

# Adding calculated data columns
tweet_ratio$fraction = tweet_ratio$count / sum(tweet_ratio$count)
tweet_ratio$percentage = tweet_ratio$count / sum(tweet_ratio$count) * 100
tweet_ratio$ymax = cumsum(tweet_ratio$fraction)
tweet_ratio$ymin = c(0, head(tweet_ratio$ymax, n=-1))

#Rounding to two decimal points
tweet_ratio<-round_df(tweet_ratio,2)

#Creating the legend
TweetType<-paste(tweet_ratio$category, tweet_ratio$percentage, "%")

#Plotting the data
ggplot(tweet_ratio,aes(ymax=ymax, ymin=ymin, xmax=4,xmin=3,fill=TweetType))+
  geom_rect()+
  coord_polar(theta="y")+
  xlim(c(2,4))+
  theme_void()+
  theme(legend.position = "right")+ 
  scale_fill_manual(values=c( "#79FDB1","#B4E6EA","#1D244E"))
```

### Analyzing Text of Tweets
```{r text-analysis, echo=FALSE}
#Remove retweets
ADC_tweets_organic <- ADC[ADC$is_retweet==FALSE, ] 
# Remove replies
ADC_tweets_organic <- subset(ADC_tweets_organic, is.na(ADC_tweets_organic$reply_to_status_id)) 

ADC_text_tweets <- ADC_tweets_organic %>%
  select(text) %>%
  unnest_tokens(word, text)

#cleaning organic tweets of any characters we don't want to show in the analysis, like @ or links
ADC_text_tweets$word <-  gsub("https\\S*", "", ADC_text_tweets$word)
ADC_text_tweets$word <-  gsub("@\\S*", "", ADC_text_tweets$word) 
ADC_text_tweets$word  <-  gsub("amp", "", ADC_text_tweets$word) 
#ADC_text_tweets$word  <-  gsub("[\r\n]", "", ADC_text_tweets$word)
#ADC_text_tweets$word  <-  gsub("[:digit:]", "", ADC_text_tweets$word)
#ADC_text_tweets$word  <-  gsub("[:punct:]", "", ADC_text_tweets$word)

#removing stop words from the text

ADC_text_tweets<-as.data.frame(ADC_text_tweets,na.rm=TRUE)
ADC_text_tweets$word<-as.character(ADC_text_tweets$word)

all_stops <- as.data.frame(stopwords("en"))
colnames(all_stops)<- c("word")
all_stops$word<-as.character(all_stops$word)

ADC_text_tweets_cleaned <-ADC_text_tweets[!ADC_text_tweets$word%in%all_stops$word,]

ADC_text_tweets_cleaned<-as.data.frame(table(ADC_text_tweets_cleaned))

ADC_text_tweets_cleaned <- ADC_text_tweets_cleaned %>% arrange(-Freq)
ADC_text_tweets_cleaned <- ADC_text_tweets_cleaned[c(3:5, 7:10, 12:15,18:21),]

ADC_text_tweets_cleanedgraph<-ADC_text_tweets_cleaned %>% 
  ggplot(aes(x=reorder(ADC_text_tweets_cleaned,Freq),y=Freq))+
  geom_col(fill="#156760", color="#79FDB1")+
  coord_flip() +
  labs(y="Count",
      x="Unique Words",
      title="Top 15 frequently used words in the Arctic Data Center's tweets",
      caption ="Common stop words removed from list.")

ADC_text_tweets_cleanedgraph+theme_ADC()
```

```{r  echo=FALSE, message=FALSE,warning=FALSE}

```
